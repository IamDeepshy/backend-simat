generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model user {
  id            Int               @id @default(autoincrement())
  username      String            @unique
  password      String
  role          String
  created_at    DateTime          @default(now())
  updated_at    DateTime          @default(now()) @updatedAt
  assignedTasks task_management[] @relation("AssignedDev")
  reopenedTasks task_management[] @relation("ReopenedBy")
}

model task_management {
  id          Int       @id @default(autoincrement())
  suiteName   String
  title       String
  priority    String
  status      String
  notes       String
  created_at  DateTime  @default(now())
  updated_at  DateTime  @default(now()) @updatedAt
  assignDevId Int
  reopenedAt  DateTime? @db.DateTime(0)
  reopenedBy  Int?
  is_hidden   Boolean   @default(false)
  assignDev   user      @relation("AssignedDev", fields: [assignDevId], references: [id], map: "fk_task_assignDevId")
  reopened_by user?     @relation("ReopenedBy", fields: [reopenedBy], references: [id], onUpdate: NoAction, map: "fk_task_reopened_by")
  testSpecId  Int?
  testSpec    test_specs? @relation(fields: [testSpecId], references: [id], map: "fk_task_testSpecId")

  @@index([assignDevId], map: "fk_task_assignDevId")
  @@index([reopenedBy], map: "fk_task_reopened_by")
  @@index([testSpecId])
}

model test_run {
  id         Int          @id @default(autoincrement())
  scope      String
  scopeValue String
  totalPass  Int
  totalFail  Int
  status     String
  allureUrl  String?
  executedAt DateTime
  createdAt  DateTime     @default(now())
  test_specs test_specs[]

  @@unique([scope, scopeValue], name: "scope_scopeValue")
}

model test_specs {
  id            Int      @id @default(autoincrement())
  testCaseId    String
  suiteName     String
  testName      String
  status        String
  durationMs    Int
  errorMessage  String?  @db.Text
  screenshotUrl String?
  lastRunAt     DateTime
  runId         Int
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  specPath      String?  @db.VarChar(255)
  test_run      test_run @relation(fields: [runId], references: [id])
  tasks         task_management[]

  @@unique([specPath, suiteName])
  @@index([runId], map: "test_specs_runId_fkey")
}