generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model user {
  id         Int      @id @default(autoincrement())
  username   String   @unique
  password   String
  role       String
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  assignedTasks task_management[] @relation("AssignedDev")
  reopenedTasks task_management[] @relation("ReopenedBy")
}

model task_management {
  id        Int    @id @default(autoincrement())
  suiteName String
  title     String

  assignDevId Int
  assignDev   user @relation("AssignedDev", fields: [assignDevId], references: [id])

  priority String
  status   String
  notes    String @db.VarChar(255)

  is_hidden Boolean @default(false)

  reopenedAt  DateTime?
  reopenedBy  Int?
  reopened_by user?     @relation("ReopenedBy", fields: [reopenedBy], references: [id])

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
}

model test_run {
  id         Int      @id @default(autoincrement())
  scope      String
  scopeValue String
  totalPass  Int
  totalFail  Int
  status     String
  allureUrl  String?
  executedAt DateTime
  createdAt  DateTime @default(now())

  @@unique([scope, scopeValue])
}

model test_specs {
  id            Int      @id @default(autoincrement())
  testCaseId    String   @unique
  suiteName     String
  testName      String
  status        String
  durationMs    Int
  errorMessage  String?  @db.Text
  screenshotUrl String?
  lastRunAt     DateTime
  runId         Int
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  specPath      String?  @db.VarChar(255)

  @@unique([specPath, testName])
  @@index([runId], map: "test_specs_runId_fkey")
}
